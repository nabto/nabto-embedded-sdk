cmake_minimum_required(VERSION 3.24)

project(example_superbuild)

project(cmake_find_package)

include(ExternalProject)


ExternalProject_Add(
  NabtoCommon
  SOURCE_DIR ${CMAKE_CURRENT_LIST_DIR}/../../../nabto-common
  CMAKE_ARGS -DCMAKE_POSITION_INDEPENDENT_CODE=ON -DCMAKE_INSTALL_PREFIX=${CMAKE_INSTALL_PREFIX}
  BUILD_ALWAYS ON
)


ExternalProject_Add(
  Libevent
  SOURCE_DIR ${CMAKE_CURRENT_LIST_DIR}/../../../3rdparty/libevent/libevent
  CMAKE_ARGS -DCMAKE_POSITION_INDEPENDENT_CODE=ON -DCMAKE_INSTALL_PREFIX=${CMAKE_INSTALL_PREFIX}
  BUILD_ALWAYS ON
)

ExternalProject_Add(
  MbedTLS
  SOURCE_DIR ${CMAKE_CURRENT_LIST_DIR}/../../../3rdparty/mbedtls/mbedtls
  CMAKE_ARGS -DENABLE_PROGRAMS=OFF -DCMAKE_POSITION_INDEPENDENT_CODE=ON -DCMAKE_INSTALL_PREFIX=${CMAKE_INSTALL_PREFIX}
  BUILD_ALWAYS ON
)

ExternalProject_Add(
  NabtoEmbeddedSDK
  SOURCE_DIR ${CMAKE_CURRENT_LIST_DIR}/../../..
  CMAKE_ARGS -DCMAKE_POSITION_INDEPENDENT_CODE=ON -DMbedTLS_DIR=${VCPKG_INSTALLED_DIR} -DCMAKE_INSTALL_PREFIX=${CMAKE_INSTALL_PREFIX}
  DEPENDS Libevent MbedTLS NabtoCommon
  BUILD_ALWAYS ON
)

ExternalProject_Add(
    example
    SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/example
    CMAKE_ARGS -DCMAKE_POSITION_INDEPENDENT_CODE=ON -DCMAKE_INSTALL_PREFIX=${CMAKE_INSTALL_PREFIX}
    DEPENDS NabtoEmbeddedSDK Libevent MbedTLS NabtoCommon
)
